<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Command Center | CampusBuddy AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .sidebar-dark { background: #0f172a; }
        .custom-scrollbar::-webkit-scrollbar { height: 6px; width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="bg-slate-50 flex min-h-screen">

    <aside class="w-72 sidebar-dark text-white hidden lg:flex flex-col p-8 sticky top-0 h-screen">
        <div class="flex items-center gap-3 mb-12">
            <span class="text-2xl">üõ°Ô∏è</span>
            <h1 class="text-xl font-black tracking-tight uppercase">Admin Console</h1>
        </div>
        
        <nav class="space-y-3 flex-1">
            <div class="text-slate-500 text-[10px] font-black uppercase tracking-[0.2em] mb-4">Main Menu</div>
            <a href="#" class="flex items-center gap-3 bg-blue-600 text-white p-4 rounded-2xl font-bold shadow-lg shadow-blue-900/20">
                <span>üìä</span> Overview
            </a>
            <a href="index.html" class="flex items-center gap-3 text-slate-400 hover:text-white p-4 rounded-2xl transition font-bold">
                <span>üè†</span> Home Page
            </a>
        </nav>

        <div class="pt-6 border-t border-slate-800">
            <button id="logoutBtn" class="w-full bg-slate-800 hover:bg-red-900/30 text-red-400 p-4 rounded-2xl transition font-black text-xs uppercase tracking-widest">
                Sign Out
            </button>
        </div>
    </aside>

    <main class="flex-1 p-6 lg:p-12">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-4">
            <div>
                <h2 class="text-3xl font-black text-slate-900">Live Reports</h2>
                <p class="text-slate-500 font-medium">Real-time infrastructure management</p>
            </div>
            <div class="flex items-center gap-3 bg-white px-4 py-2 rounded-2xl border shadow-sm">
                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                <span class="text-xs font-black text-slate-600 uppercase tracking-widest">Database Linked</span>
            </div>
        </div>

        <div class="bg-white rounded-[2.5rem] shadow-sm border border-slate-100 overflow-hidden">
            <div class="overflow-x-auto custom-scrollbar">
                <table class="w-full text-left">
                    <thead class="bg-slate-50/50 text-slate-400 text-[11px] font-black uppercase tracking-widest border-b">
                        <tr>
                            <th class="p-8">Reference</th>
                            <th class="p-8">Description</th>
                            <th class="p-8">Status</th>
                            <th class="p-8">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="adminTableBody" class="divide-y divide-slate-50">
                        </tbody>
                </table>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, query, orderBy, onSnapshot, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { /* PASTE_YOUR_FIREBASE_CONFIG_HERE */ };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // 1. SECURITY GUARD: Only allow access if logged in
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = "admin-login.html";
            }
        });

        // 2. LIVE DATA FETCHING
        const q = query(collection(db, "reports"), orderBy("timestamp", "desc"));
        onSnapshot(q, (snapshot) => {
            const tableBody = document.getElementById('adminTableBody');
            tableBody.innerHTML = "";
            
            snapshot.forEach((docSnap) => {
                const data = docSnap.data();
                const id = docSnap.id;
                
                tableBody.innerHTML += `
                    <tr class="hover:bg-slate-50/80 transition-all">
                        <td class="p-8">
                            <p class="font-black text-slate-800 text-sm">#${id.substring(0,6).toUpperCase()}</p>
                            <p class="text-[10px] text-slate-400 font-bold">SYSTEM_ENTRY</p>
                        </td>
                        <td class="p-8">
                            <p class="text-sm font-bold text-slate-700 mb-1">${data.description}</p>
                            <a href="${data.imageUrl}" target="_blank" class="text-[10px] text-blue-600 font-black hover:underline uppercase tracking-tighter">View Evidence Photo ‚Üí</a>
                        </td>
                        <td class="p-8">
                            <span class="px-4 py-2 rounded-full text-[10px] font-black uppercase tracking-widest ${getStatusStyle(data.status)}">
                                ${data.status}
                            </span>
                        </td>
                        <td class="p-8">
                            <select onchange="window.changeStatus('${id}', this.value)" class="bg-white border-2 border-slate-100 text-[11px] font-black rounded-xl p-3 outline-none focus:border-blue-500 transition-all cursor-pointer uppercase">
                                <option value="Pending" ${data.status === 'Pending' ? 'selected' : ''}>Pending</option>
                                <option value="In Progress" ${data.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                                <option value="Resolved" ${data.status === 'Resolved' ? 'selected' : ''}>Resolved</option>
                            </select>
                        </td>
                    </tr>`;
            });
        });

        function getStatusStyle(status) {
            if (status === "Resolved") return "bg-green-100 text-green-700 border border-green-200";
            if (status === "In Progress") return "bg-blue-100 text-blue-700 border border-blue-200";
            return "bg-amber-100 text-amber-700 border border-amber-200";
        }

        // 3. ACTION HANDLERS
        window.changeStatus = async (docId, newStatus) => {
            await updateDoc(doc(db, "reports", docId), { status: newStatus });
        };

        document.getElementById('logoutBtn').onclick = () => {
            signOut(auth).then(() => window.location.href = "admin-login.html");
        };
    </script>
</body>
</html>